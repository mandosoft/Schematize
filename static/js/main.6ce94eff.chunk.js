(this.webpackJsonpschematize=this.webpackJsonpschematize||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(22),i=n.n(s),a=(n(48),n(16)),l=n(6),c=n(7),p=n(10),u=n(9),h=n(8),d=n(11),m=n(14),f=(n(94),n(17)),g=n(1),v=n(31),b=n.n(v),y=n(42);function k(e){if(""===e)return!1;var t=new XMLHttpRequest;return t.open("HEAD","/Schematize"+e,!1),t.send(),404!==t.status}function x(){return(x=Object(y.a)(b.a.mark((function e(t,n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new XMLHttpRequest).onreadystatechange=function(){4===r.readyState&&200===r.status&&n(r.responseText)},e.next=4,r.open("GET",t,!0);case 4:r.send(null);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){return Object(f.a)(Array(1+t-e).keys()).map((function(t){return e+t}))}var O=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(u.a)(t).call(this,e))).pathNames=[],n.components=[],n.chunkIndex=null,n.jsonCache={},n.chunksProcessed=[],n.nucleotides=[],n.loadIndexFile(n.props.store.jsonName),Object(g.v)(n.props.store,"jsonName",(function(){n.loadIndexFile(n.props.store.jsonName)})),Object(g.v)(n.props.store,"indexSelectedZoomLevel",(function(){n.loadIndexFile(n.props.store.jsonName)})),Object(g.v)(n.props.store.beginEndBin,n.openRelevantChunksFromIndex.bind(Object(h.a)(n))),Object(g.v)(n.props.store.chunkFastaURLs,(function(){n.loadFasta()})),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"openRelevantChunksFromIndex",value:function(){if(null!==this.chunkIndex){var e=this.chunkIndex,t=this.props.store.getBeginBin(),n=this.props.store.getEndBin();this.props.store.setAvailableZoomLevels(Object.keys(e.zoom_levels));var r=this.props.store.getSelectedZoomLevel(),o=e.zoom_levels[r].files.length-1,s=e.zoom_levels[r].files.findIndex((function(e){return e.last_bin>=t})),i=e.zoom_levels[r].files.findIndex((function(e){return e.last_bin>=n}));if(-1===i&&(i=o),-1!==s){var a="/Schematizetest_data/"+this.props.store.jsonName+"/"+r+"/",l=C(s,i).map((function(t){return a+e.zoom_levels[r].files[t].file}));this.props.store.switchChunkURLs(l);var c=C(s,i).map((function(t){return a+e.zoom_levels[r].files[t].fasta}));this.props.store.switchChunkFastaURLs(c),this.props.store.setChunkBeginEndBin(e.zoom_levels[r].files[s].first_bin,e.zoom_levels[r].files[i].last_bin)}else console.error("beginIndex",s,"endIndex",i)}}},{key:"loadIndexFile",value:function(e){var t=this,n="/Schematizetest_data/"+e+"/bin2file.json";return console.log("Reading",n),fetch(n).then((function(e){return e.json()})).then((function(e){t.chunkIndex=e,t.openRelevantChunksFromIndex()}))}},{key:"jsonFetch",value:function(e){if(!e)throw new Error("No filepath given. Ensure chunknames in bin2file.json are correct.");return console.log("Fetching",e),fetch("/Schematize"+e).then((function(e){return e.json()}))}},{key:"loadJsonCache",value:function(e,t){if(14!==t.json_version)throw MediaError("Wrong Data JSON version: was expecting version 14, got "+t.json_version+".  This version added precaculated X values.  Using a mismatched data file and renderer will cause unpredictable behavior, instead generate a new data file using github.com/graph-genome/component_segmentation.");this.jsonCache[e]=t,this.pathNames=t.path_names,this.props.store.setBinWidth(parseInt(t.bin_width))}},{key:"loadFasta",value:function(){var e=this;console.log("loadFasta"),this.nucleotides=[];var t=!0,n=!1,r=void 0;try{for(var o,s=function(){var t=o.value;k(t)&&fetch(t).then((function(e){return e.text()})).then((function(n){var r,o=n.replace(/.*/,"").substr(1).replace(/[\r\n]+/gm,"");(r=e.nucleotides).push.apply(r,Object(f.a)(o.split(""))),console.log("fetching_fasta: ",t)}))},i=this.props.store.getChunkFastaURLs()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)s()}catch(a){n=!0,r=a}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"processArray",value:function(){var e=[this.props.store.getBeginBin(),this.props.store.getEndBin()],t=e[0],n=e[1],r=this.props.store.getChunkURLs();0!==this.chunksProcessed.length&&this.chunksProcessed[0]===r[0]||(this.components=[],this.chunksProcessed=[]),console.log("Parsing components ",t," - ",n);for(var o=0;o<r.length;o++)if(o>=this.chunksProcessed.length){if(!(r[o]in this.jsonCache))return!1;var s=r[o],i=this.jsonCache[s],l=this.components.length?this.components.slice(-1)[0].nextXOffset():0,c=!0,p=!1,u=void 0;try{for(var h,d=i.components.entries()[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var m=h.value,f=Object(a.a)(m,2),g=f[0],v=f[1],b=new w(v,l,g);l=b.nextXOffset(),this.components.push(b)}}catch(y){p=!0,u=y}finally{try{c||null==d.return||d.return()}finally{if(p)throw u}}this.chunksProcessed.push(s)}return console.log("processArray",this.chunksProcessed[0],this.chunksProcessed.slice(-1)[0]),!0}}]),t}(o.a.Component),w=function(){function e(t,n,r){Object(l.a)(this,e),this.offset=n,this.index=r,this.firstBin=t.first_bin,this.lastBin=t.last_bin,this.arrivals=[];var o=!0,s=!1,i=void 0;try{for(var a,c=t.arrivals[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var p=a.value;this.arrivals.push(new j(p))}}catch(v){s=!0,i=v}finally{try{o||null==c.return||c.return()}finally{if(s)throw i}}this.departures=[];var u=!0,h=!1,d=void 0;try{for(var m,f=t.departures[Symbol.iterator]();!(u=(m=f.next()).done);u=!0){var g=m.value;this.departures.push(new j(g))}}catch(v){h=!0,d=v}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}this.x=0,this.occupants=Array.from(t.occupants),this.matrix=Array.from(t.matrix),this.num_bin=this.lastBin-this.firstBin+1}return Object(c.a)(e,[{key:"nextXOffset",value:function(){return this.offset+this.arrivals.length+this.departures.length-1}}]),e}(),j=function(){function e(t){Object(l.a)(this,e),this.upstream=t.upstream,this.downstream=t.downstream,this.participants=t.participants,this.key=this.edgeToKey()}return Object(c.a)(e,[{key:"edgeToKey",value:function(){return String(this.downstream).padStart(13,"0")+String(this.upstream).padStart(13,"0")}}]),e}(),E=O,L=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={color:n.props.color},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement(m.Rect,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height||1,fill:this.state.color})}}]),t}(o.a.Component),S=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"onHover",value:function(){var e='"';e+=this.props.pathName+'": ';for(var t=this.props.item[2],n=0;n<t.length;n++){var r=t[n][0],o=t[n][1];e+=0===n?r+"-"+o:","+r+"-"+o}this.props.store.updateCellTooltipContent(e)}},{key:"onLeave",value:function(){this.props.store.updateCellTooltipContent("")}},{key:"render",value:function(){var e=this.props.item[1]>.5,t="#838383";return e&&(t="#DE4B39"),this.props.item[0]>1&&(t="#6A6A6A"),o.a.createElement(o.a.Fragment,null,o.a.createElement(m.Rect,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height||1,fill:t}),o.a.createElement(m.Text,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height||1,align:"center",verticalAlign:"center",text:e?"<":" ",onMouseEnter:this.onHover.bind(this),onMouseLeave:this.onLeave.bind(this)}))}}]),t}(o.a.Component),N=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.map((function(e,t){return n.reduce((function(e,n){return[].concat(Object(f.a)(e),[n[t]])}),[e])}))};function P(e){for(var t=function(e){return e.length?N.apply(void 0,Object(f.a)(e.map((function(e){return e.occupants})))).map((function(e){return e.some((function(e){return e}))})):[!1]}(e),n={},r=0,o=0;o<t.length;o++)t[o]&&(n[o]=r,r++);return n}function B(e,t){return e+t}var R=function(e){function t(){var e,n;Object(l.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=Object(p.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={color:"lightgray"},n.handleClick=function(){"lightgray"===n.state.color?n.setState({color:"lightblue"}):"lightblue"===n.state.color&&n.setState({color:"lightgray"})},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderMatrix",value:function(){var e=this,t=0,n=this.props.item.matrix.map((function(n,r){return n.length?(t++,e.renderMatrixRow(n,t,r)):null}));return this.props.store.updateMaxHeight(t),o.a.createElement(o.a.Fragment,null,n)}},{key:"renderMatrixRow",value:function(e,t,n){var r=this,s=this.props.item,i=s.x+s.arrivals.length*this.props.store.pixelsPerColumn,a=1*this.props.store.pixelsPerColumn,l=t;if(!this.props.store.useVerticalCompression){if(!this.props.compressed_row_mapping.hasOwnProperty(n))return null;l=this.props.compressed_row_mapping[n]}return e.map((function(e,t){return e.length?o.a.createElement(o.a.Fragment,null,o.a.createElement(S,{key:"occupant"+n+t,item:e,store:r.props.store,pathName:r.props.pathNames[n],x:i+t*r.props.store.pixelsPerColumn,y:l*r.props.store.pixelsPerRow+r.props.store.topOffset,row_number:n,width:a,height:r.props.store.pixelsPerRow})):null}))}},{key:"renderAllConnectors",value:function(){var e=this,t=this.props.item.departures,n=t.slice(-1)[0];if(void 0!==n){var r=0;return t.length>1&&(r+=t.slice(0,-1).map((function(e){return e.participants.reduce(B)})).reduce(B)),o.a.createElement(o.a.Fragment,null,n.participants.map((function(t,n){return t?(r++,e.renderComponentConnector(t,r,n)):null})))}return null}},{key:"renderComponentConnector",value:function(e,t,n){var r=this.props.item,s=r.x+(r.arrivals.length+(this.props.store.useWidthCompression?this.props.store.binScalingFactor:r.num_bin)+r.departures.length-1)*this.props.store.pixelsPerColumn,i=t;return this.props.store.useVerticalCompression||(i=this.props.compressed_row_mapping[n]),o.a.createElement(L,{key:"connector"+n,x:s,y:this.props.store.topOffset+i*this.props.store.pixelsPerRow+this.props.store.nucleotideHeight,width:this.props.store.pixelsPerColumn,height:this.props.store.pixelsPerRow,color:"#464646"})}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.Rect,{x:this.props.item.x,y:this.props.store.topOffset,width:this.props.width*this.props.store.pixelsPerColumn,height:this.props.height*this.props.store.pixelsPerRow,fill:this.state.color,onClick:this.handleClick}),this.props.store.useWidthCompression?null:this.renderMatrix(),this.props.store.useConnector?this.renderAllConnectors():null)}}]),t}(o.a.Component),M=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderMatrix",value:function(){var e=this,t=0,n=this.props.item.matrix.map((function(n,r){return n.length&&1===++t?e.renderMatrixRow(n,r):null}));return o.a.createElement(o.a.Fragment,null,n)}},{key:"renderMatrixRow",value:function(e,t){var n=this,r=this.props.item,s=r.x+r.arrivals.length*this.props.store.pixelsPerColumn,i=1*this.props.store.pixelsPerColumn;return e.map((function(e,t){return e.length?o.a.createElement(o.a.Fragment,null,o.a.createElement(m.Text,{x:s+t*n.props.store.pixelsPerColumn,y:n.props.store.topOffset-n.props.store.nucleotideHeight,text:n.props.nucleotides[t],align:"center",height:n.props.store.nucleotideHeight,width:i})):null}))}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(m.Rect,{x:this.props.item.x,y:this.props.store.topOffset+this.props.store.nucleotideHeight,width:this.props.width*this.props.store.pixelsPerColumn,height:this.props.height*this.props.store.pixelsPerRow}),this.renderMatrix())}}]),t}(o.a.Component),_=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(u.a)(t).call(this,e))).handleMouseOut=n.handleMouseOut.bind(Object(h.a)(n)),n.handleMouseOver=n.handleMouseOver.bind(Object(h.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleMouseOver",value:function(){this.props.updateHighlightedNode(this.props.item)}},{key:"handleMouseOut",value:function(){this.props.updateHighlightedNode(null)}},{key:"linkCells",value:function(){var e=[],t=1,n=!0,r=!1,o=void 0;try{for(var s,i=this.props.item.participants.entries()[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var l=s.value,c=Object(a.a)(l,2),p=c[0];if(c[1]){var u=t++;if(!this.props.store.useVerticalCompression){if(!this.props.compressed_row_mapping.hasOwnProperty(p))continue;u=this.props.compressed_row_mapping[p]}var h=u*this.props.store.pixelsPerRow;e.push(h)}}}catch(d){r=!0,o=d}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return e}},{key:"componentDidMount",value:function(){this.setState({color:this.props.color})}},{key:"render",value:function(){var e=this,t=this.linkCells();return o.a.createElement(o.a.Fragment,null,t.map((function(t,n){return o.a.createElement(m.Rect,{key:"dot"+n,x:e.props.x,y:e.props.store.topOffset+t+e.props.store.nucleotideHeight,width:e.props.store.pixelsPerColumn,height:e.props.store.pixelsPerRow,fill:e.props.color,opacity:e.props.opacity,stroke:e.props.stroke,onMouseOver:e.handleMouseOver,onMouseOut:e.handleMouseOut})})))}}]),t}(o.a.Component);function F(e){return!Number.isFinite(e)}var H=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(u.a)(t).call(this,e))).handleMouseOver=function(){n.props.updateHighlightedNode(n.props.link.linkColumn)},n.handleMouseOut=function(){n.props.updateHighlightedNode(null)},n.handleClick=function(e){console.log("Click",e,n.props.link);var t=n.props.store.getBeginEndBin(),r=Object(a.a)(t,2),o=r[0],s=r[1]-o,i=o+s/2,l=~~((Math.abs(n.props.link.linkColumn.upstream-i)<Math.abs(n.props.link.linkColumn.downstream-i)?n.props.link.linkColumn.downstream:n.props.link.linkColumn.upstream)-s/2),c=l+s;n.props.store.updateBeginEndBin(l,c),n.props.updateSelectedLink(n.props.link.linkColumn)},n.arrowXCoord=null,n.points=[],n.handleMouseOut=n.handleMouseOut.bind(Object(h.a)(n)),n.handleMouseOver=n.handleMouseOver.bind(Object(h.a)(n)),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"calculatePoints",value:function(){var e=this.props.link;this.arrowXCoord=this.props.link.xArrival;var t=this.props.link.xDepart-this.arrowXCoord+this.props.store.pixelsPerColumn/2,n=this.props.store.pixelsPerColumn/2,r=t<0?-1:1,o=[t,this.props.store.pixelsPerColumn-2],s=[t-r,2-e.elevation],i=[t-6*r,-e.elevation],a=[n+6*r,-e.elevation],l=[n+r,2-e.elevation],c=[n,-5];this.points=[o[0],o[1],s[0],s[1],i[0],i[1],a[0],a[1],l[0],l[1],c[0],c[1],n,-1],Math.abs(t)<=this.props.store.pixelsPerColumn&&(e.isArrival?this.points=[n,-10,n,-2]:this.points=[o[0],-2+this.props.store.pixelsPerColumn,o[0],-5]),(this.points.some(isNaN)||this.points.some(F))&&console.log("Some points are NaN: "+this.points)}},{key:"render",value:function(){return this.calculatePoints(),o.a.createElement(m.Arrow,{x:this.arrowXCoord,y:this.props.store.topOffset-10,width:this.props.store.pixelsPerColumn,points:this.points,bezier:!1,strokeWidth:this.props.store.pixelsPerColumn,fill:this.props.color,stroke:this.props.color,opacity:this.props.opacity,"stroke-opacity":this.props.opacity,pointerLength:1,pointerWidth:1,tension:1/3,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onClick:this.handleClick})}}]),t}(o.a.Component),A=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;Object(l.a)(this,e),this.linkColumn=t,void 0===t&&console.log(t,n,r),this.xArrival=n,this.xDepart=r,this.elevation=10,this.isArrival=o}return Object(c.a)(e,[{key:"distance",value:function(){return Math.abs(this.xDepart-this.xArrival)||1}}]),e}();function W(e,t,n,r,o,s){for(var i={},a=0;a<e.length;a++){var l=e[a];l.x=s(l,a,0,0);for(var c=0;c<l.arrivals.length;c++){var p=l.arrivals[c],u=s(l,a,0,c),h=p.key;h in i?i[h].xArrival=u:i[h]=new A(p,u,u,!0)}for(var d=0;d<l.departures.length-1;d++){var m=l.departures[d],g=s(l,a,l.arrivals.length+(r?o:l.num_bin),d),v=m.key;v in i?i[v].xDepart=g:i[v]=new A(m,g,g,!1)}}return function(e,t,n){var r=Object.values(e).sort((function(e,t){return e.distance()-t.distance()})),o=function(e,t,n){var r=Math.max.apply(Math,[0].concat(Object(f.a)(e.map((function(e){return Math.max(e.xDepart,e.xArrival)}))))),o=new Array(r).fill(15),s=!0,i=!1,a=void 0;try{for(var l,c=e[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var p=l.value,u=Math.max(0,Math.min(p.xArrival,p.xDepart)),h=Math.max(p.xArrival,p.xDepart,u+1),d=o.slice(u,h+1),m=d.length?Math.max.apply(Math,Object(f.a)(d)):10;!isNaN(m)&&Number.isFinite(m)||console.log("Bad elevation",p,u,h,d,o);m+=t;for(var g=u;g<h&&g<o.length;g++)o[g]=m;p.elevation=m}}catch(v){i=!0,a=v}finally{try{s||null==c.return||c.return()}finally{if(i)throw a}}return o}(r,t),s=Math.max.apply(Math,Object(f.a)(o))+3*t;return[r,s]}(i,t)}var U=n(43),I=n(18),T=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(U.a,{visible:!0,offsetX:15,offsetY:-20,style:{background:"white"}},o.a.createElement(I.a,null,(function(){return o.a.createElement("span",null,e.props.store.cellToolTipContent)})))}}]),t}(o.a.Component),Z=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"shift",value:function(e){var t=this.props.store.getBeginBin(),n=this.props.store.getEndBin(),r=n-t,o=Math.floor(r*(e/100));console.log(n+"-"+t+"="+r+" --\x3e diff: "+o),this.props.store.updateBeginEndBin(t+o,n+o)}},{key:"handleJump",value:function(){console.log("JUMP: path name: "+this.props.store.getPath()+" nucleotide position: "+this.props.store.getNucPos());var e=this.props.store,t=e.pathIndexServerAddress,n=e.getPath(),r=e.getNucPos(),o=e.binWidth;!function(e,t){x.apply(this,arguments)}(t+n+"/"+r,(function(t){if("0"===t)alert("The jump query returned 0. Either your path does not exist or your position in the path is wrong. Please try again.");else{console.log(t),t=parseInt(t);var n=Math.ceil(t/o);console.log(n),e.updateBeginEndBin(n,e.getEndBin())}}))}},{key:"change_zoom_level",value:function(e){console.log("change_zoom_level: "+e.value+" ---"+e.options[e.selectedIndex].text),this.props.store.setIndexSelectedZoomLevel(parseInt(e.value))}},{key:"decIndexSelectedZoomLevel",value:function(){var e=this.props.store.indexSelectedZoomLevel;e>0&&this.props.store.setIndexSelectedZoomLevel(e-1)}},{key:"incIndexSelectedZoomLevel",value:function(){var e=this.props.store.indexSelectedZoomLevel;e<this.props.store.availableZoomLevels.length-1&&this.props.store.setIndexSelectedZoomLevel(e+1)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{id:"button-container"},o.a.createElement("button",{className:"button",id:"btn-download"},"Save Image"),o.a.createElement("input",{type:"text",defaultValue:this.props.store.jsonName,style:{width:"330px"},onChange:this.props.store.tryJSONpath,title:"File:"}),o.a.createElement("span",{style:{marginLeft:"30px"}},"Bin width:",o.a.createElement("button",{className:"button",onClick:function(){return e.decIndexSelectedZoomLevel()}},"-"),o.a.createElement("select",{id:"select_bin_width",onChange:function(t){return e.change_zoom_level(t.target)},value:this.props.store.indexSelectedZoomLevel},this.props.store.availableZoomLevels.map((function(e,t){return o.a.createElement("option",{key:t,value:t},e)}))),o.a.createElement("button",{className:"button",onClick:function(){return e.incIndexSelectedZoomLevel()}},"+")),o.a.createElement("span",{style:{marginLeft:"30px"}},o.a.createElement("button",{className:"button",onClick:function(){return e.shift(-100)}},"<<"),o.a.createElement("button",{className:"button",onClick:function(){return e.shift(-50)}},"<"),"Pangenome Bin Position:",o.a.createElement(I.a,null,(function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("input",{type:"number",value:e.props.store.beginEndBin[0],onChange:function(t){return e.props.store.updateBeginEndBin(t.target.value,e.props.store.getEndBin())},style:{width:"80px"}}),"-",o.a.createElement("input",{type:"number",value:e.props.store.beginEndBin[1],readOnly:!0,style:{width:"80px"}}))})),o.a.createElement("button",{className:"button",onClick:function(){return e.shift(50)}},">"),o.a.createElement("button",{className:"button",onClick:function(){return e.shift(100)}},">>")),o.a.createElement("div",{className:"row"},"Jump to path at nucleotide position:",o.a.createElement("input",{type:"string",list:"path",placeholder:"path",onChange:function(t){return e.props.store.updatePathNucPos(t.target.value,e.props.store.getNucPos())},style:{width:"80px"}}),o.a.createElement("datalist",{id:"path"},this.props.schematic.pathNames.map((function(e,t){return o.a.createElement("option",{key:t,value:e})}))),"-",o.a.createElement("input",{type:"number",placeholder:"position",onChange:function(t){return e.props.store.updatePathNucPos(e.props.store.getPath(),t.target.value)},style:{width:"80px"}}),o.a.createElement("span",{style:{marginLeft:"2px"}},o.a.createElement("button",{className:"button",onClick:function(){return e.handleJump()}},"Jump"))),o.a.createElement("div",{className:"row"},o.a.createElement("span",null," ","Use Vertical Compression:",o.a.createElement(z,{store:this.props.store})),o.a.createElement("span",null," ","Use Width Compression:",o.a.createElement(D,{store:this.props.store})),this.props.store.useWidthCompression?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null," ","Render Connectors:",o.a.createElement(X,{store:this.props.store})),o.a.createElement("span",null," ","Component Width Scaling Factor:",o.a.createElement(I.a,null,(function(){return o.a.createElement("input",{type:"number",min:1,value:e.props.store.binScalingFactor,onChange:e.props.store.updateBinScalingFactor,style:{width:"30px"}})})))):o.a.createElement(o.a.Fragment,null),o.a.createElement("span",null," ","Row Height:",o.a.createElement("input",{type:"number",min:1,value:this.props.store.pixelsPerRow,onChange:this.props.store.updateHeight,style:{width:"30px"}})),o.a.createElement("span",null," ","Column Width:",o.a.createElement("input",{type:"number",min:1,value:this.props.store.pixelsPerColumn,onChange:this.props.store.updateWidth,style:{width:"30px"}}))))}}]),t}(o.a.Component),z=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(I.a,null,(function(){return o.a.createElement("input",{type:"checkbox",checked:e.props.store.useVerticalCompression,onChange:e.props.store.toggleUseVerticalCompression})}))}}]),t}(o.a.Component),X=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(I.a,null,(function(){return o.a.createElement("input",{type:"checkbox",checked:e.props.store.useConnector,onChange:e.props.store.toggleUseConnector})}))}}]),t}(o.a.Component),D=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(I.a,null,(function(){return o.a.createElement("input",{type:"checkbox",checked:e.props.store.useWidthCompression,onChange:e.props.store.toggleUseWidthCompression})}))}}]),t}(o.a.Component),V=Z;function J(e,t,n){var r=(e.downstream+1)*(e.upstream+1),o=n||t;return!t&&!n||r===(o.downstream+1)*(o.upstream+1)?[Y(r),1,t||n?"black":null]:["gray",.3,null]}var Y=function(e){e=e.toString();for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);for(var r="#",o=0;o<3;o++){r+=("00"+(t>>8*o&255).toString(16)).substr(-2)}return r},q=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(p.a)(this,Object(u.a)(t).call(this,e))).layerRef=o.a.createRef(),n.layerRef2=o.a.createRef(null),n.layerRef3=o.a.createRef(null),n.timerHighlightingLink=null,n.timerSelectionLink=null,n.componentDidMount=function(){var e=document.getElementById("button-container").clientHeight;document.getElementsByClassName("konvajs-content")[0].style.position="relative",n.setState({buttonsHeight:e}),n.layerRef.current.getCanvas()._canvas.id="cnvs",n.layerRef.current.getCanvas()._canvas.position="relative",n.layerRef2.current.getCanvas()._canvas.id="arrow",n.layerRef2.current.getCanvas()._canvas.position="relative"},n._updateHighlightedNode=function(e){n.setState({highlightedLink:e}),n.recalcXLayout()},n.updateHighlightedNode=function(e){n.state.selectedLink||(null!=e?(clearTimeout(n.timerHighlightingLink),n.state.highlightedLink!==e&&(n.timerHighlightingLink=setTimeout((function(){n._updateHighlightedNode(e)}),600))):(clearTimeout(n.timerHighlightingLink),null!=n.state.highlightedLink&&(n.timerHighlightingLink=setTimeout((function(){n._updateHighlightedNode(e)}),600))))},n.updateSelectedLink=function(e){console.log("updateSelectedLink"),e!==n.state.selectedLink&&(console.log("updateSelectedLink - NewSelection"),clearTimeout(n.timerHighlightingLink),n.setState({highlightedLink:e,selectedLink:e})),e&&(clearTimeout(n.timerSelectionLink),n.timerSelectionLink=setTimeout((function(){n.updateSelectedLink(null)}),5e3))},n.renderNucleotidesSchematic=function(){if(!n.state.loading&&1===n.props.store.binWidth&&!n.props.store.useWidthCompression&&n.schematic.nucleotides.length>0)return n.schematic.components.map((function(e,t){var r=n.props.store.getChunkBeginEndBin()[0],s=n.schematic.nucleotides.slice(e.firstBin-r,e.lastBin-r+1);return o.a.createElement(o.a.Fragment,{key:"nt"+t},o.a.createElement(M,{store:n.props.store,item:e,key:t,height:n.visibleHeight(),width:e.arrivals.length+(n.props.store.useWidthCompression?n.props.store.binScalingFactor:e.num_bin)+(e.departures.length-1),nucleotides:s}))}))},n.updateHighlightedNode=n.updateHighlightedNode.bind(Object(h.a)(n)),n.updateSelectedLink=n.updateSelectedLink.bind(Object(h.a)(n)),n.state={schematize:[],pathNames:[],loading:!0,actualWidth:1,buttonsHeight:0},n.schematic=new E({store:n.props.store}),Object(g.v)(n.props.store.beginEndBin,n.updateSchematicMetadata.bind(Object(h.a)(n))),Object(g.v)(n.props.store.chunkURLs,n.fetchAllChunks.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"pixelsPerRow",n.recalcY.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"useVerticalCompression",n.recalcY.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"useWidthCompression",n.recalcXLayout.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"useConnector",n.recalcXLayout.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"binScalingFactor",n.recalcXLayout.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"pixelsPerColumn",n.recalcXLayout.bind(Object(h.a)(n))),Object(g.v)(n.props.store,"pixelsPerColumn",n.calculateBinWidthOfScreen.bind(Object(h.a)(n))),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"fetchAllChunks",value:function(){var e=this;if(console.log("fetchAllChunks",this.props.store.getChunkURLs()),this.props.store.getChunkURLs()[0]){var t=!0,n=!1,r=void 0;try{for(var o,s=function(){var t=o.value;e.schematic.jsonFetch(t).then((function(n){return e.schematic.loadJsonCache(t,n)})).then(e.updateSchematicMetadata.bind(e))},i=this.props.store.chunkURLs[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)s()}catch(a){n=!0,r=a}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}else console.warn("No chunk URL defined.")}},{key:"updateSchematicMetadata",value:function(){var e=this;this.schematic.processArray()&&(console.log("updateSchematicMetadata #components: "+this.schematic.components.length),this.setState({schematize:this.schematic.components,pathNames:this.schematic.pathNames},(function(){e.recalcXLayout(),e.compressed_row_mapping=P(e.schematic.components),e.maxNumRowsAcrossComponents=e.calcMaxNumRowsAcrossComponents(e.schematic.components),e.setState({loading:!1})})))}},{key:"recalcXLayout",value:function(){var e=this;console.log("recalcXLayout");var t=this.schematic.components.map((function(t){return t.arrivals.length+(t.departures.length-1)+(e.props.store.useWidthCompression?e.props.store.binScalingFactor:t.lastBin-t.firstBin)+1})).reduce((function(e,t){return e+t}),0),n=this.props.store.pixelsPerColumn*this.schematic.components.length,r=t*this.props.store.pixelsPerColumn+n;this.setState({actualWidth:r});var o=W(this.schematic.components,this.props.store.pixelsPerColumn,this.props.store.topOffset,this.props.store.useWidthCompression,this.props.store.binScalingFactor,this.leftXStart.bind(this)),s=Object(a.a)(o,2),i=s[0],l=s[1];this.distanceSortedLinks=i,this.props.store.updateTopOffset(parseInt(l))}},{key:"recalcY",value:function(){this.setState({highlightedLink:null})}},{key:"componentDidUpdate",value:function(e,t,n){this.props.store.getBeginBin()===e.store.getBeginBin()&&this.props.store.getEndBin()===e.store.getEndBin()||this.updateSchematicMetadata()}},{key:"calcMaxNumRowsAcrossComponents",value:function(e){for(var t=0,n=0;n<e.length;n++){var r=e[n].occupants.filter(Boolean).length;t=Math.max(r,t)}return console.log("Max number of rows across components: "+t),t}},{key:"visibleHeight",value:function(){return this.props.store.useVerticalCompression||!this.compressed_row_mapping?(void 0===this.maxNumRowsAcrossComponents&&(this.maxNumRowsAcrossComponents=this.calcMaxNumRowsAcrossComponents(this.schematic.components)),console.log("maxNumRowsAcrossComponents",this.maxNumRowsAcrossComponents),(this.maxNumRowsAcrossComponents+2.5)*this.props.store.pixelsPerRow):(Object.keys(this.compressed_row_mapping).length+.25)*this.props.store.pixelsPerRow}},{key:"calculateBinWidthOfScreen",value:function(){var e=1920/this.props.store.pixelsPerColumn,t=this.props.store.getBeginBin();this.props.store.updateBeginEndBin(t,t+e)}},{key:"UNSAFE_componentWillMount",value:function(){this.updateSchematicMetadata()}},{key:"leftXStart",value:function(e,t,n,r){return((this.props.store.useWidthCompression?e.offset+(e.index-this.schematic.components[0].index)*this.props.store.binScalingFactor:e.firstBin-this.props.store.getBeginBin()+e.offset)+n+r)*this.props.store.pixelsPerColumn+t*this.props.store.pixelsPerColumn}},{key:"renderComponent",value:function(e,t,n){var r=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(R,{store:this.props.store,item:e,key:t,height:this.visibleHeight(),width:e.arrivals.length+(this.props.store.useWidthCompression?this.props.store.binScalingFactor:e.num_bin)+(e.departures.length-1),compressed_row_mapping:this.compressed_row_mapping,pathNames:n}),e.arrivals.map((function(n,o){return r.renderLinkColumn(e,t,0,o,n)})),e.departures.slice(0,-1).map((function(n,o){var s=e.arrivals.length+(r.props.store.useWidthCompression?r.props.store.binScalingFactor:e.num_bin);return r.renderLinkColumn(e,t,s,o,n)})))}},{key:"renderLinkColumn",value:function(e,t,n,r,s){var i=this.leftXStart(e,t,n,r),l=J(s,this.state.highlightedLink,this.state.selectedLink),c=Object(a.a)(l,3),p=c[0],u=c[1],h=c[2];return o.a.createElement(_,{store:this.props.store,key:"departure"+t+r,item:s,pathNames:this.state.pathNames,x:i,pixelsPerRow:this.props.store.pixelsPerRow,width:this.props.store.pixelsPerColumn,color:p,opacity:u,stroke:h,updateHighlightedNode:this.updateHighlightedNode,compressed_row_mapping:this.compressed_row_mapping})}},{key:"renderLink",value:function(e){var t=J(e.linkColumn,this.state.highlightedLink,this.state.selectedLink),n=Object(a.a)(t,2),r=n[0],s=n[1];return o.a.createElement(H,{store:this.props.store,key:"arrow"+e.linkColumn.key,link:e,color:r,opacity:s,updateHighlightedNode:this.updateHighlightedNode,updateSelectedLink:this.updateSelectedLink})}},{key:"renderSchematic",value:function(){var e=this;if(!this.state.loading)return this.schematic.components.map((function(t,n){return o.a.createElement(o.a.Fragment,{key:"f"+n},e.renderComponent(t,n,e.state.pathNames))}))}},{key:"renderSortedLinks",value:function(){var e=this;if(!this.state.loading)return this.distanceSortedLinks.map((function(t,n){return e.renderLink(t)}))}},{key:"loadingMessage",value:function(){if(this.state.loading)return o.a.createElement(m.Text,{y:100,fontSize:60,width:300,align:"center",text:"Loading..."})}},{key:"render",value:function(){return console.log("Start render"),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{position:"sticky",top:0,zIndex:"2",background:"white",width:this.state.actualWidth+60,minWidth:"100%"}},o.a.createElement(V,{store:this.props.store,schematic:this.schematic}),o.a.createElement(m.Stage,{x:this.props.store.leftOffset,y:this.props.topOffset,width:this.state.actualWidth+60,height:this.props.store.topOffset},o.a.createElement(m.Layer,{ref:this.layerRef2},this.renderSortedLinks(),this.renderNucleotidesSchematic()))),o.a.createElement(m.Stage,{x:this.props.store.leftOffset,y:-this.props.store.topOffset,width:this.state.actualWidth+60,height:this.visibleHeight()+this.props.store.nucleotideHeight},o.a.createElement(m.Layer,{ref:this.layerRef},this.loadingMessage(),this.renderSchematic())),o.a.createElement(T,{store:this.props.store}))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var K=n(13),G=K.a.optional(K.a.array(K.a.integer),[1,60]),$=K.a.optional(K.a.array(K.a.string),[""]),Q=K.a.optional(K.a.array(K.a.string),[""]),ee=K.a.optional(K.a.array(K.a.integer),[-1,0]),te=K.a.model("PathNucPos",{path:K.a.string,nucPos:K.a.integer}),ne=K.a.model({useVerticalCompression:!1,useWidthCompression:!1,binScalingFactor:3,useConnector:!0,beginEndBin:G,pixelsPerColumn:10,pixelsPerRow:10,leftOffset:25,topOffset:400,highlightedLink:0,maximumHeightThisFrame:150,cellToolTipContent:"",jsonName:"SARS-CoV-2.genbank.20200329.complete",availableZoomLevels:K.a.optional(K.a.array(K.a.string),["1"]),indexSelectedZoomLevel:0,chunkURLs:$,chunkFastaURLs:Q,chunkBeginEndBin:ee,pathNucPos:K.a.optional(te,{path:"path",nucPos:0}),pathIndexServerAddress:"http://193.196.29.24:3010/",binWidth:100,nucleotideHeight:10,pangenomelast_bin:-1}).actions((function(e){function t(){return e.beginEndBin}function n(){return t()[0]}function r(){return t()[1]}return{updateBeginEndBin:function(t,o){t=Math.max(1,Math.round(t)),o=Math.max(1,Math.round(o));var s,i,a=n(),l=r();o===l&&(o=t+(l-a)),o<t&&(t=o-1),s=t,i=o,e.beginEndBin=[s,i],console.log("updateBeginEnd: "+t+" "+o),console.log("updatedBeginEnd: "+e.beginEndBin[0]+" "+e.beginEndBin[1])},updateTopOffset:function(t){Number.isFinite(t)&&Number.isSafeInteger(t)&&(e.topOffset=t+10)},updateHighlightedLink:function(t){e.highlightedLink=t},updateMaxHeight:function(t){e.maximumHeightThisFrame=Math.max(e.maximumHeightThisFrame,t)},resetRenderStats:function(){e.maximumHeightThisFrame=1},updateCellTooltipContent:function(t){e.cellToolTipContent=String(t)},updateBinScalingFactor:function(t){var n=t.target.value;e.binScalingFactor=Math.max(1,Number(n))},toggleUseVerticalCompression:function(){e.useVerticalCompression=!e.useVerticalCompression},toggleUseWidthCompression:function(){e.useWidthCompression=!e.useWidthCompression},toggleUseConnector:function(){e.useConnector=!e.useConnector},updateHeight:function(t){e.pixelsPerRow=Math.max(1,Number(t.target.value))},updateWidth:function(t){e.pixelsPerColumn=Number(t.target.value)},tryJSONpath:function(t){k("/Schematizetest_data/"+t.target.value+"/bin2file.json")&&(e.jsonName=t.target.value)},switchChunkURLs:function(t){t.length===e.chunkURLs.length&&t.every((function(t){return e.chunkURLs.indexOf(t)>-1}))||(e.chunkURLs=t,console.log("arrayOfFile: "+t))},getChunkURLs:function(){return e.chunkURLs},switchChunkFastaURLs:function(t){t.length===e.chunkFastaURLs.length&&t.every((function(t){return e.chunkFastaURLs.indexOf(t)>-1}))||(e.chunkFastaURLs=t,console.log("arrayOfFastaFile: "+t))},getChunkFastaURLs:function(){return e.chunkFastaURLs},setChunkBeginEndBin:function(t,n){e.chunkBeginEndBin=[t,n]},getChunkBeginEndBin:function(){return e.chunkBeginEndBin},getBeginEndBin:t,getBeginBin:n,getEndBin:r,getPath:function(){return e.pathNucPos.path},getNucPos:function(){return e.pathNucPos.nucPos},getPathNucPos:function(){return e.pathNucPos},updatePathNucPos:function(t,n){n=n?parseInt(n):0,e.pathNucPos={path:t,nucPos:n}},setBinWidth:function(t){e.binWidth=t},getSelectedZoomLevel:function(){return e.availableZoomLevels[e.indexSelectedZoomLevel]},setIndexSelectedZoomLevel:function(t){e.indexSelectedZoomLevel=t},setAvailableZoomLevels:function(t){e.availableZoomLevels=t}}})).views((function(e){return{}})).create({});i.a.render(o.a.createElement(q,{store:ne}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},44:function(e,t,n){e.exports=n(100)},48:function(e,t,n){},94:function(e,t,n){}},[[44,1,2]]]);
//# sourceMappingURL=main.6ce94eff.chunk.js.map